Weather events in the US:
========================================
Analysis of the consequences to population health and properties
================================================================
The present analysis explores the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database, in order to answer the two following questions:

1. Across the United States, which types of events are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

The major work of data processing consists in collapsing the original more than 900 categories of events into the 48 of the codebook. 

It is found that heat and tornados are respectively the first and second cause of fatalities by weather events. While their rank is reversed in considering the injuries, they remain the most harmful events.
The weather events that cause most damages to crop and propertiy are floods, followed by hurricanes and storm surges. The breakdown of the damage to crops shows that the major events affecting crops are droughts, floods and hurricanes, but damages to crop are relateviley small compared to the ones to properties. 


#Data Processing

###Loading data and documentation
```{r Loading packages, warning=FALSE}
library(lubridate)
library(dplyr)
library(ggplot2)
library(scales)
```

```{r Download data and documentation, cache=TRUE}
link_data <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
link_doc1 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf"
link_doc2 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf"

##create directory for raw data
if(!file.exists("./raw_data")) {
      dir.create("./raw_data")
      }
##download data and create log file of the download
if(!file.exists("./raw_data/StormData.csv.bz2")) {
      link <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
      date <- date()
      log <- paste("Data downloaded from:", link, "on", date, sep = " ")
      write.table(log, "./raw_data/data_access_log.txt")
      download.file(link_data, 
                    "./raw_data/StormData.csv.bz2", 
                    method = "curl")
      rm(date, link, log)
      }
##download documentation
if(!file.exists("./raw_data/StormDataDoc.pdf")) {
      download.file(link_doc1, 
                    "./raw_data/StormDataDoc.pdf", 
                    method = "curl")
      }
if(!file.exists("./raw_data/StormDataFAQ.pdf")) {
      download.file(link_doc2, 
                    "./raw_data/StormDataFAQ.pdf", 
                    method = "curl")
      }
```

```{r Read the data, cache=TRUE}
#read the compressed data and remove unused variables
if(!exists("StormData")) {
      StormData <- read.csv(bzfile("./raw_data/StormData.csv.bz2"), stringsAsFactors = FALSE, header = TRUE)
      }

rm(link_doc1, link_doc2, link_data)
```
###Extract the working dataset
First we read the headings of the original dataset
```{r Headings of the dataset, fig.width=10}
names(StormData)
```
The following code select the relevant variables from the dataset and creates the working dataset **df**.

```{r Select relevant columns, cache=TRUE, fig.width=10}
df <- with(StormData, 
           data.frame(state = STATE,
                      bgn_date = as.Date(as.character(StormData$BGN_DATE), format = "%m/%d/%Y"),
                      evtype = as.factor(EVTYPE), 
                      fatalities = FATALITIES, 
                      injuries = INJURIES, 
                      propdmg = PROPDMG, 
                      propdmgexp = PROPDMGEXP, 
                      cropdmg = CROPDMG, 
                      cropdmgexp = CROPDMGEXP
                      )
           
           )

head(df)
```

###Processing of the working dataset

####Relevant years

The documentation explains that the years before 1995 have little data and are not recorded according to the codebook. The following plot shows the number of observations per year.

```{r Graph1 - Number of observations per year, fig.width=10}
ggplot(df, aes(x = as.factor(year(bgn_date)))) +
      geom_bar(fill = "lightgoldenrod4") +
      theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
      ggtitle("Number of observations per year") +
      labs(x = "Year")

```
**Graph1.**Number of observations by year.

The number of observations from the year 1995 contututes 79% of the total:

```{r, fig.width=10}
df_temp <- df %>% mutate(year = year(bgn_date)) %>% group_by(year) %>% summarize(count = n())
with(df_temp, sum(filter(df_temp, year >= 1995))/sum(count)) 
```

Therefore the data prior to 1995 is filtered out.

```{r Removing data before year 1995, fig.width=10}                                                           
df <- filter(df, year(bgn_date) >= 1995)
```

####Event types: Evtype

In order to categorise the events, the documentation that comes with the original dataset (downloadable [here](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf"Documentation")) proposes 48 categories (**evtype**) of weather events (StormDataDoc.pdf, p.6, table 1. Storm Data Event Table).

```{r Categories from the documentation}
evtype_doc <- c("Astronomical Low Tide",
                "Avalanche",
                "Blizzard",
                "Coastal Flood",
                "Cold/Wind Chill",
                "Debris Flow",
                "Dense Fog",
                "Dense Smoke",
                "Drought",
                "Dust Devil",
                "Dust Storm",
                "Excessive Heat",
                "Extreme Cold/Wind Chill",
                "Flash Flood",
                "Flood",
                "Frost/Freeze",
                "Funnel Cloud",
                "Freezing Fog",
                "Hail",
                "Heat",
                "Heavy Rain",
                "Heavy Snow",
                "High Surf",
                "High Wind",
                "Hurricane (Typhoon)",
                "Ice Storm",
                "Lake-Effect Snow",
                "Lakeshore Flood",
                "Lightning",
                "Marine Hail",
                "Marine High Wind",
                "Marine Strong Wind",
                "Marine Thunderstorm Wind",
                "Rip Current",
                "Seiche",
                "Sleet",
                "Storm Surge/Tide",
                "Strong Wind",
                "Thunderstorm Wind",
                "Tornado",
                "Tropical Depression",
                "Tropical Storm",
                "Tsunami",
                "Volcanic Ash",
                "Waterspout",
                "Wildfire",
                "Winter Storm",
                "Winter Weather")
```

On the other hand, the data presents more than 900 evtype categories

```{r, fig.width=10}
evtype_data <- as.character(levels(df$evtype))
cbind(EVTYPE.DOCUMENTATION = length(evtype_doc), EVTYPE.DATA = length(levels(df$evtype)))
```
Above the numbers of categories in the codebook and the number of categories found in the dataset

In summary the method used to clean the data's weather event categories is to use a dataframe where one column contains the categories of the dataset and the other column contains the corresponding categories of the documentation. This dataframe is than used to replace the evtype column of the dataset.
Which dataset's category goes where is explicitly reported so that can be checked and commented on.

The following code creates the dataframe **evtype_clean** with two columns: the first (**evtype**) corresponds to the categories from the data and the second one (**output**) corresponds to the relative categories from the documentation.
The output variable is created by performing the following grep functions on the first one and add the new variable in the relevant rows. 
This list of patterns has been created by first using the 48 documentation's categories and then manually refining until the wanted result was achieved.

```{r Clean evtypes}
#create a dataframe with the categories from the data and a column "output", with only NAs values
evtype_clean <- data.frame(evtype = evtype_data, output = NA, stringsAsFactors = FALSE)
#use the 48 categories of the documentation as pattern for grep
#a category "Summary" to include some entries in the data that are not specific and are noted as summary with a date
evtype_clean$output[grep("Summary", evtype_clean$evtype, ignore.case = TRUE)]<- "Summary"
evtype_clean$output[grep("Astronomical Low Tide", evtype_clean$evtype, ignore.case = TRUE)]<- "Astronomical Low Tide"
evtype_clean$output[grep("Avalanche", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("Blizzard", evtype_clean$evtype, ignore.case = TRUE)]<- "Blizzard"
evtype_clean$output[grep("Coastal Flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("Cold Wind Chill", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold Wind Chill"
evtype_clean$output[grep("Debris Flow", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("Dense Fog", evtype_clean$evtype, ignore.case = TRUE)]<- "Dense Fog"
evtype_clean$output[grep("Dense Smoke", evtype_clean$evtype, ignore.case = TRUE)]<- "Dense Smoke"
evtype_clean$output[grep("Drought", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("Dust Devil", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Devil"
evtype_clean$output[grep("Dust Storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("Excessive Heat", evtype_clean$evtype, ignore.case = TRUE)]<- "Excessive Heat"
evtype_clean$output[grep("Extreme Cold Wind Chill", evtype_clean$evtype, ignore.case = TRUE)]<- "Extreme Cold Wind Chill"
evtype_clean$output[grep("Flash Flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("Flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("Frost Freeze", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost Freeze"
evtype_clean$output[grep("Funnel Cloud", evtype_clean$evtype, ignore.case = TRUE)]<- "Funnel Cloud"
evtype_clean$output[grep("Freezing Fog", evtype_clean$evtype, ignore.case = TRUE)]<- "Freezing Fog"
evtype_clean$output[grep("Hail", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("Heat", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("Heavy Rain", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("Heavy Snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("High Surf", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("High Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Hurricane  Typhoon ", evtype_clean$evtype, ignore.case = TRUE)]<- "Hurricane  Typhoon "
evtype_clean$output[grep("Ice Storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Ice Storm"
evtype_clean$output[grep("Lake-Effect Snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Lake-Effect Snow"
evtype_clean$output[grep("Lakeshore Flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Lakeshore Flood"
evtype_clean$output[grep("Lightning", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("Marine Hail", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Hail"
evtype_clean$output[grep("Marine High Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine High Wind"
evtype_clean$output[grep("Marine Strong Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Strong Wind"
evtype_clean$output[grep("Marine Thunderstorm Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Thunderstorm Wind"
evtype_clean$output[grep("Rip Current", evtype_clean$evtype, ignore.case = TRUE)]<- "Rip Current"
evtype_clean$output[grep("Seiche", evtype_clean$evtype, ignore.case = TRUE)]<- "Seiche"
evtype_clean$output[grep("Sleet", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("Storm Surge Tide", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge Tide"
evtype_clean$output[grep("Strong Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Strong Wind"
evtype_clean$output[grep("Thunderstorm Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("Tornado", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("Tropical Depression", evtype_clean$evtype, ignore.case = TRUE)]<- "Tropical Depression"
evtype_clean$output[grep("Tropical Storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Tropical Storm"
evtype_clean$output[grep("Tsunami", evtype_clean$evtype, ignore.case = TRUE)]<- "Tsunami"
evtype_clean$output[grep("Volcanic Ash", evtype_clean$evtype, ignore.case = TRUE)]<- "Volcanic Ash"
evtype_clean$output[grep("Waterspout", evtype_clean$evtype, ignore.case = TRUE)]<- "Waterspout"
evtype_clean$output[grep("Wildfire", evtype_clean$evtype, ignore.case = TRUE)]<- "Wildfire"
evtype_clean$output[grep("Winter Storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Storm"
evtype_clean$output[grep("Winter Weather", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Weather"

evtype_clean$output[grep("landslide", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("landslides", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("landspout", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("landslump", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("warmth", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("hot", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("dry", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("below normal", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("driest", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("dryness", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("snows", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("snowfall", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("blowing-snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("freeze", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("cool", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("frost", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("cold", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("glaze", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("ice", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("low temperature", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("beach", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("devel", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("flash", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("flashflooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("high tide", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("blow-out", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("windchill", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("wind chill", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("wind chills", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("fire", evtype_clean$evtype, ignore.case = TRUE)]<- "Wildfire"
evtype_clean$output[grep("fires", evtype_clean$evtype, ignore.case = TRUE)]<- "Wildfire"
evtype_clean$output[grep("Coastal flooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("coastal flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("coastal erosion", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("cstl flooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("coastal storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Strong Wind"
evtype_clean$output[grep("coastalstorm", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Strong Wind"
evtype_clean$output[grep("precipitation", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("precipatation", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("precip", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("rainfall", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("shower", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("showers", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("rainstorm", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("fog", evtype_clean$evtype, ignore.case = TRUE)]<- "Dense Fog"
evtype_clean$output[grep("gustnado", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("surf", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("high winds", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("hurricane", evtype_clean$evtype, ignore.case = TRUE)]<- "Hurricane (Typhoon)"
evtype_clean$output[grep("ligthing", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("ligntning", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("mudslide", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("mudslides", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("thunderstorm", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("thunderstorms", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("thundeerstorm", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("thundersnow", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("tstm", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("tstmw", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("small", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("urban", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("Volcanic", evtype_clean$evtype, ignore.case = TRUE)]<- "Volcanic Ash"
evtype_clean$output[grep("water spout", evtype_clean$evtype, ignore.case = TRUE)]<- "Waterspout"
evtype_clean$output[grep("wayterspout", evtype_clean$evtype, ignore.case = TRUE)]<- "Waterspout"
evtype_clean$output[grep("wintery", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Weather"
evtype_clean$output[grep("wintry", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Weather"
evtype_clean$output[grep("flash floooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("flash flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD FLOOD/FLASH", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD/FLASH", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD/FLASH FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD/FLASH FLOODING", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD/FLASH/FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("FLOOD/FLASHFLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("avalace", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("beach", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("below normal", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("blizzard", evtype_clean$evtype, ignore.case = TRUE)]<- "Blizzard"
evtype_clean$output[grep("dust", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("coastal flooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("coastal flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("tidal flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("coastalflood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("cstl flooding", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("cstl flood", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("cold/winds", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("downburst", evtype_clean$evtype, ignore.case = TRUE)]<- "Cold/Wind Chill"
evtype_clean$output[grep("drought", evtype_clean$evtype, ignore.case = TRUE)]<- "Drought"
evtype_clean$output[grep("dust storm", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("duststorm", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("microburst", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("rain", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("wetness", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("wet", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("Flood & heavy rain", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("FREEZING DRIZZLE", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("FREEZING DRIZZLE AND FREEZING", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("funnel", evtype_clean$evtype, ignore.case = TRUE)]<- "Funnel Cloud"
evtype_clean$output[grep("funnels", evtype_clean$evtype, ignore.case = TRUE)]<- "Funnel Cloud"
evtype_clean$output[grep("Flood/Strong Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("Freezing Rain", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Freezing Spray", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Freezing drizzle", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Freezing rain", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Freezing Drizzle", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("HEAVY RAIN/LIGHTNING", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("HEAVY SNOW AND HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW AND STRONG WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/HIGH WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/HIGH WINDS & FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/HIGH WINDS/FREEZING", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/ICE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/ICE STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/SQUALLS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/WINTER STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOWPACK", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SURF COASTAL FLOODING", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("HIGH  SWELLS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("HIGH SEAS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("HIGH TEMPERATURE RECORD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("HIGH WATER", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("HIGH WAVES", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("HOT/DRY PATTERN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("HURRICANE OPAL/HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Hurricane (Typhoon)"
evtype_clean$output[grep("HVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("Heavy Rain/High Surf", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("ICE/STRONG WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("ICY ROADS", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("LACK OF SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Lake-Effect Snow"
evtype_clean$output[grep("LAKE EFFECT SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Lake-Effect Snow"
evtype_clean$output[grep("LAKE FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Lakeshore Flood"
evtype_clean$output[grep("LAKESHORE FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Lakeshore Flood"
evtype_clean$output[grep("LANDSLIDE/URBAN FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("LARGE WALL CLOUD", evtype_clean$evtype, ignore.case = TRUE)]<- "Dense Fog"
evtype_clean$output[grep("LIGHT FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("LIGHT SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("LIGHT SNOW/FREEZING PRECIP", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("LIGHTING", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LIGNTNING", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LOCAL FLASH FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Flash Flood"
evtype_clean$output[grep("Lake Effect Snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Lake-Effect Snow"
evtype_clean$output[grep("Light snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Light Snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Light Snow/Flurries", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Light Snowfall", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Light snow", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("MARINE STRONG WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine High Wind"
evtype_clean$output[grep("MARINE THUNDERSTORM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Thunderstorm Wind"
evtype_clean$output[grep("MARINE TSTM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine Thunderstorm Wind"
evtype_clean$output[grep("MUD SLIDE", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("MUD SLIDES", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("MUD/ROCK SLIDE", evtype_clean$evtype, ignore.case = TRUE)]<- "Debris Flow"
evtype_clean$output[grep("NON TSTM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("NON-SEVERE WIND DAMAGE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("PROLONGED RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("RAPIDLY RISING WATER", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("RECORD COLD AND HIGH WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("RECORD HIGH", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD HIGH TEMPERATURE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD HIGH TEMPERATURES", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD SNOW/COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("RECORD TEMPERATURE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD TEMPERATURES", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD WARM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("RECORD WARM TEMPS.", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("ROCK SLIDE", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("ROGUE WAVE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("ROUGH SEAS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("Record High", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Record Temperatures", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("SAHARAN DUST", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Storm"
evtype_clean$output[grep("SEVERE TURBULENCE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("SMOKE", evtype_clean$evtype, ignore.case = TRUE)]<- "Wildfire"
evtype_clean$output[grep("SNOW AND COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW AND HEAVY SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW AND ICE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW AND ICE STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW AND SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW AND WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW DROUGHT", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW SHOWERS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW SQUALL", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW SQUALLS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW- HIGH WIND- WIND CHILL", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/ BITTER COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/ ICE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/BLOWING SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/HEAVY SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/ICE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/ICE STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/RAIN/SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/SLEET/FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW/SLEET/RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOWFALL RECORD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOWMELT FLOODING", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOWSTORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("SNOW\\COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("STORM FORCE WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("STORM SURGE", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("STORM SURGE/TIDE", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("Sml Stream Fld", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("TORNDAO", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("TORRENTIAL RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("TSTM HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("TUNDERSTORM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("TYPHOON", evtype_clean$evtype, ignore.case = TRUE)]<- "Hurricane (Typhoon)"
evtype_clean$output[grep("Temperature record", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WARM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WARM & WET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WARM AND DRY", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WARM YEAR", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WARM/WET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("UNSEASONABLY WET", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("UNSEASONAL RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Rain"
evtype_clean$output[grep("UNSEASONAL LOW TEMP", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("UNUSUALLY WARM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("avalance", evtype_clean$evtype, ignore.case = TRUE)]<- "Avalanche"
evtype_clean$output[grep("blizzard", evtype_clean$evtype, ignore.case = TRUE)]<- "Blizzard"
evtype_clean$output[grep("COASTAL  FLOODING/EROSION", evtype_clean$evtype, ignore.case = TRUE)]<- "Coastal Flood"
evtype_clean$output[grep("COASTAL SURGE", evtype_clean$evtype, ignore.case = TRUE)]<- "Storm Surge/Tide"
evtype_clean$output[grep("COLD AIR TORNADO", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("COLD AND WET CONDITIONS", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("COOL AND WET", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("DAM BREAK", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("DAM FAILURE", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("DOWNBURST", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("DOWNBURST WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Dust Devil", evtype_clean$evtype, ignore.case = TRUE)]<- "Dust Devil"
evtype_clean$output[grep("FLOOD/RAIN/WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("FLOOD/RAIN/WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("FLOODING/HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Flood"
evtype_clean$output[grep("GRADIENT WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GRADIENT WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GUSTY LAKE WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GUSTY WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GUSTY WIND/HAIL", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GUSTY WIND/HVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("GUSTY WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Gradient wind", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Gusty Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Gusty Winds", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Gusty wind/rain", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Gusty winds", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HAIL/ICY ROADS", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("HAIL/WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("HAIL/WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("HAILSTORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("HAILSTORMS", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("HEAVY SNOW   FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW & ICE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/BLIZZARD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SNOW/BLIZZARD/AVALANCHE", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("HEAVY SWELLS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"
evtype_clean$output[grep("HIGH  WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND (G40)", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND 48", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND 63", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND 70", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND AND HEAVY SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND AND HIGH TIDES", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND AND SEAS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND DAMAGE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/ BLIZZARD", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/BLIZZARD", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/BLIZZARD/FREEZING RA", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/HEAVY SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/LOW WIND CHILL", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/SEAS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/WIND CHILL", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WIND/WIND CHILL/BLIZZARD", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 55", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 57", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 58", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 63", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 66", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 67", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 73", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 76", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 80", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS 82", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS AND WIND CHILL", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS DUST STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS HEAVY RAINS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/COASTAL FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/FLOODING", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HIGH WINDS/SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("HYPERTHERMIA/EXPOSURE", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("HYPOTHERMIA", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("HYPOTHERMIA/EXPOSURE", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("Heavy snow shower", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("Hypothermia/Exposure", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("ICE STORM/FLASH FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("LAKE-EFFECT SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Lake-Effect Snow"
evtype_clean$output[grep("LIGHT SNOW AND SLEET", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("LIGHTNING AND HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LIGHTNING AND THUNDERSTORM WIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LIGHTNING AND WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LIGHTNING/HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Lightning"
evtype_clean$output[grep("LOW TEMPERATURE RECORD", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("MARINE HIGH WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Marine High Wind"
evtype_clean$output[grep("RECORD LOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("RECORD LOW RAINFALL", evtype_clean$evtype, ignore.case = TRUE)]<- "Frost/Freeze"
evtype_clean$output[grep("SLEET & FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SLEET STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SLEET/FREEZING RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SLEET/ICE STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SLEET/RAIN/SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SLEET/SNOW", evtype_clean$evtype, ignore.case = TRUE)]<- "Sleet"
evtype_clean$output[grep("SNOW\\COLD", evtype_clean$evtype, ignore.case = TRUE)]<- "Heavy Snow"
evtype_clean$output[grep("STRONG WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("STRONG WIND GUST", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("STRONG WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Small Hail", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("Strong Wind", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Strong Winds", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("Strong winds", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("THUDERSTORM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERESTORM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS FUNNEL CLOU", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS SMALL STREA", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS URBAN FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS/FLASH FLOOD", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS/FUNNEL CLOU", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTORM WINDS/HEAVY RAIN", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTROM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERSTROM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERTORM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDERTSORM WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNDESTORM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("THUNERSTORM WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Thunderstorm Wind"
evtype_clean$output[grep("TORNADO/WATERSPOUT", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("TORNADOES, TSTM WIND, HAIL", evtype_clean$evtype, ignore.case = TRUE)]<- "Tornado"
evtype_clean$output[grep("VERY WARM", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("WARM WEATHER", evtype_clean$evtype, ignore.case = TRUE)]<- "Heat"
evtype_clean$output[grep("WIND ADVISORY", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WIND AND WAVE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WIND DAMAGE", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WIND GUSTS", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WIND STORM", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WIND/HAIL", evtype_clean$evtype, ignore.case = TRUE)]<- "High Wind"
evtype_clean$output[grep("WINTER STORM HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Storm"
evtype_clean$output[grep("WINTER STORM/HIGH WIND", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Storm"
evtype_clean$output[grep("WINTER STORM/HIGH WINDS", evtype_clean$evtype, ignore.case = TRUE)]<- "Winter Storm"
evtype_clean$output[grep("small hail", evtype_clean$evtype, ignore.case = TRUE)]<- "Hail"
evtype_clean$output[grep("heavy seas",evtype_clean$evtype, ignore.case = TRUE)]<- "High Surf"


evtype_clean$evtype <- as.factor(evtype_clean$evtype)
evtype_clean$output <- as.factor(evtype_clean$output)
```

The following is a list showing how every category of the dataset has been replaced with a category from the documentation.

```{r Table of replacement, fig.width=10}
print(evtype_clean)
```

This list is used to reassign the categories to the working dataframe **df**.

```{r, fig.width=10}
levels(df$evtype) <- as.factor(evtype_clean$output)
```

The result are the following categories for event types (evtype)
```{r, fig.width=10}
levels(df$evtype)
```

###Correcting an inflated damage

The following table show the most damaging events of all. The top one appears to be inflated by a factor of 1000. 

```{r, fig.width=10}
head(arrange(filter(df, propdmgexp == "B"), desc(propdmg)), 10)
```

Further investigation on the website of the National Climatic Data Center confirmed that the value is not 115B but 115M. It is therefore corrected accordingly.

```{r}
index <- which(df$propdmg == 115 & df$propdmgexp == "B")
df$propdmgexp[index] <- "M"

```
###Cleaning PROPDMGEXP and CROPDMGEXP

The two variable **propdmg** and **cropdmgexp** indicate the multipliers for the relative variables **propdmg** and **cropdmg**. 
The following tables are a rough way of checking what are the relevant codes. It indicates the codes used in the dataset and the sum of the relative damages.

```{r}
aggregate(propdmg ~ as.factor(propdmgexp), df, FUN = sum)
aggregate(cropdmg ~ as.factor(cropdmgexp), df, FUN = sum)
```

The letters "B", "M", "K" represents, according to the documentation, the multipliers 10^9, 10^6, 10^3. With the same logic "H" is interpreted as 10^2 and the numbers as exponent of 10, therefore the multipliers factors will be converted according to the following table:

```{r}
propdmgexp_conv <- data.frame(input = levels(as.factor(df$propdmgexp)), output = c(1, 0, 0, 1, 10, 10^2, 10^3, 10^4, 10^5, 10^6, 10^7, 10^8, 0, 10^9, 10^2, 10^3, 10^6,10^2, 10^6))
cropdmgexp_conv <- data.frame(input = levels(as.factor(df$cropdmgexp)), output = c(1, 1, 10^2, 0, 10^9, 10^3, 10^6, 10^3, 10^6))

propdmgexp_conv
cropdmgexp_conv
```
The following code processes the data in order to create two columns **propdmgexp2** and **cropdmgexp2** with the correct codes according to the tables above. This factors are then converted in numbers (**propdmg_rv** and **cropdmg_rv**) and summed in the variable **totaldmg**, which represents the total damage in dollars to properties and crops.
```{rEXP replacement, fig.width=9}
#create two new columns
df$propdmgexp2 <- df$propdmgexp
df$cropdmgexp2 <- df$cropdmgexp
#replace the current codes with the correct codes according to the two tables above 
levels(df$propdmgexp2) <- as.factor(propdmgexp_conv$output)
levels(df$cropdmgexp2) <- as.factor(cropdmgexp_conv$output)
#convert the factors to numbers
df$propdmg_rv <- df$propdmg*as.integer(as.character(df$propdmgexp2))
df$cropdmg_rv <- df$cropdmg*as.integer(as.character(df$cropdmgexp2))
#add a variable with the total
df$totaldmg <- df$propdmg_rv + df$cropdmg_rv
head(df)
```

#Results

###Across the United States, which types of events are most harmful with respect to population health?

In order to answer the question, we first summarise the data by evtype.

```{rGraph2 Fatalities, fig.width=9}
summary_harm <- df %>% 
      group_by(evtype) %>% 
      summarize(total_fatalities = sum(fatalities), total_injuries = sum(injuries)) %>% 
      arrange(desc(total_fatalities)) %>% 
      slice(1:15) %>%
print(summary_harm)
summary_harm <- arrange(summary_harm, total_fatalities)
```
**Table1.** The first 15 weather events ordered by fatalities caused and relative injuries.

```{r, fig.width=9, fig.height=9}
par(mfrow = c(2,1), mar = c(3, 8, 3, 2))
barplot(summary_harm$total_fatalities, 
        names.arg = summary_harm$evtype, 
        horiz = TRUE, 
        main = "Weather event types \nby number of fatalities",
        cex.names=0.8, 
        las=1, 
        col = "lightpink")
summary_harm <- arrange(summary_harm, total_injuries)
barplot(summary_harm$total_injuries, 
        names.arg = summary_harm$evtype, 
        horiz = TRUE, 
        main = "Weather event types \nby number of injuries",
        cex.names=0.8, 
        las=1, 
        col = "lightblue", 
        beside =TRUE)
```
**Graph2.**Total number of fatalities and injuries by weather event.
Heat and tornados are respectively the first and second cause of fatalities by weather events. While their rank is reversed in considering the injuries, they remain the most harmful events.

###Across the United States, which types of events have the greatest economic consequences?

First we summarise the data by weather events:

```{r Summary of damage}
summary_dmg <- df %>% group_by(evtype) %>% summarize(totpropdmg = sum(propdmg_rv), totcropdmg = sum(cropdmg_rv), totaldmg = totpropdmg + totcropdmg)
print(with(summary_dmg, 
           data.frame(evtype, totpropdmg = format(totpropdmg, big.mark = ","),
                      totcropdmg = format(totcropdmg, big.mark = ","), 
                      totaldmg = format(totaldmg, big.mark = ",")
                      )
           )
      )
```
**Table2.**Total damage to properties, crops and the sum of the two summarised by weather event.


```{rGraph3 Total damage, fig.width=9, fig.height=12}
prop <- summary_dmg %>% arrange(desc(totpropdmg)) %>% slice(1:15) %>% arrange(totpropdmg)
crop <- summary_dmg %>% arrange(desc(totcropdmg)) %>% slice(1:15) %>% arrange(totcropdmg)
tot <- summary_dmg %>% arrange(desc(totaldmg)) %>% slice(1:15) %>% arrange(totaldmg)
tick <- max(prop$totaldmg)
tick <- round(c(0, tick/4, tick/2, 3*tick/4, tick))

par(mfrow = c(3,1), mar = c(3, 8, 3, 2))

barplot(tot$totaldmg, 
        names.arg = tot$evtype, 
        xaxt = "n",
        horiz = TRUE, 
        main = "Total damage to properties and crops by event type ($)",
        cex.names=0.8, 
        las=1) 
axis(1, at = tick, labels = format(tick, big.mark = ","))

barplot(prop$totpropdmg, 
        names.arg = prop$evtype, 
        xlim = c(0, max(prop$totaldmg)),
        xaxt = "n",
        horiz = TRUE, 
        main = "Total damage to properties by event type ($)",
        cex.names=0.8, 
        las=1, 
        col = "thistle4")
axis(1, at = tick, labels = format(tick, big.mark = ","))

barplot(crop$totcropdmg, 
        names.arg = crop$evtype,
        xlim = c(0, max(prop$totaldmg)),
        xaxt = "n",
        horiz = TRUE, 
        main = "Total damage to crops by event type ($)",
        cex.names=0.8, 
        las=1, 
        col = "yellowgreen")
axis(1, at = tick, labels = format(tick, big.mark = ","))

```
**Graph3.**Damages to properties, crops and total by weather event.
The table above shows that the first four events most harmful to properties and crops are hurricanes, surge storms, floods and tornados. Hail and flash floods play an important role, too. In value, damages to properties are more important than damages to crops by almost a factor of 10. Therefore the total damage ranking is driven by damage to properties.
If we look at the ranking of the events based on damages to crops, we find that tornados and surge storms are not important anymore, hurricanes and flood still have big impact as well as droughts and cold/freeze.

